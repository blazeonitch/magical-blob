<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Magical Blob Evolution âœ¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Cherry+Bomb+One&display=swap" rel="stylesheet" />
    <link rel="icon" href="./src/favicon.svg" type="image/svg+xml" />

    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(145deg, #ffe5f9, #fdd0ff);
            font-family: 'Cherry Bomb One', cursive;
            text-align: center;
            overflow-x: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            position: relative;
        }

        h1 {
            font-size: clamp(24px, 3.5vw, 48px);
            margin: 30px 10px 10px;
            color: #ff69b4;
            text-shadow: 2px 2px #fff0f6;
        }

        #blob {
            width: clamp(120px, 40vw, 180px);
            height: clamp(120px, 40vw, 180px);
            border-radius: 50%;
            margin: 50px auto 20px;
            transition: transform 0.2s ease, box-shadow 0.2s;
            position: relative;
            background: radial-gradient(circle at 40% 40%, #ffb6d9, #ff69b4);
            box-shadow: 0 0 30px #ffb0e1;
            touch-action: manipulation;
            cursor: pointer;
        }

        #blob.happy {
            transform: scale(1.1);
            box-shadow: 0 0 50px #ff8ed6;
        }

        .face {
            position: absolute;
            top: 33%;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: clamp(24px, 6vw, 45px);
            user-select: none;
            pointer-events: none;
        }

        #count {
            font-size: clamp(18px, 5vw, 28px);
            color: #ff4fa2;
            background: #fff0f6;
            padding: 8px 20px;
            border-radius: 30px;
            display: inline-block;
            box-shadow: 0 0 10px #ffbde0;
            margin: 0 10px 10px;
        }

        .heart {
            position: absolute;
            font-size: clamp(18px, 5vw, 30px);
            color: #ff4fa2;
            animation: floatPop 1s ease-out forwards;
            pointer-events: none;
            user-select: none;
            z-index: 9999;
            transform: rotate(0deg);
        }

        .sparkle {
            position: absolute;
            font-size: clamp(12px, 4vw, 22px);
            color: #ffd6f6;
            animation: sparkleOut 0.8s ease-out forwards;
            pointer-events: none;
            user-select: none;
            z-index: 9998;
        }

        @keyframes floatPop {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1) rotate(0deg);
            }

            100% {
                opacity: 0;
                transform: translateY(-100px) scale(1.8) rotate(30deg);
            }
        }

        @keyframes sparkleOut {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }

            100% {
                opacity: 0;
                transform: translateY(-80px) scale(1.5);
            }
        }

        #accessory {
            position: absolute;
            top: -20%;
            left: 38%;
            font-size: clamp(24px, 7vw, 40px);
            pointer-events: none;
            user-select: none;
        }

        #message {
            font-size: clamp(16px, 4vw, 24px);
            color: #d23d87;
            margin-top: 15px;
            height: 2.5em;
            user-select: none;
            min-height: 30px;
        }

        #reset-btn {
            padding: 8px 14px;
            background: #ff4fa4;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: clamp(14px, 4vw, 22px);
            box-shadow: 0 4px 10px #ffb6d9;
            transition: background 0.3s ease;
            user-select: none;
            margin-top: 12px;
        }

        #reset-btn:hover {
            background: #e64593;
        }

        /* Volume slider container */
        #volume-container {
            position: fixed;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            background: #ffb6d9cc;
            border-radius: 25px;
            padding: 10px 8px;
            box-shadow: 0 0 10px #ff8ed6;
            z-index: 10000;
            user-select: none;

            /* Make container height = slider length + padding */
            height: 170px;
            /* length */
            width: 40px;
            /* thickness */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #volume-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 150px;
            /* slider length (after rotation) */
            height: 30px;
            /* slider thickness */
            transform: rotate(-90deg);
            cursor: pointer;
            background: transparent;
            outline: none;
            border-radius: 10px;
        }

        /* Track */
        #volume-slider::-webkit-slider-runnable-track {
            width: 100%;
            height: 10px;
            background: #ff69b4;
            border-radius: 25px;
        }

        #volume-slider::-moz-range-track {
            width: 100%;
            height: 10px;
            background: #ff69b4;
            border-radius: 25px;
        }

        /* Thumb */
        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            background: #fff0f6;
            border: 2px solid #ff4fa2;
            border-radius: 50%;
            cursor: pointer;
            margin-top: -9px;
            /* centers thumb */
            box-shadow: 0 0 8px #ff4fa2aa;
            transition: background 0.3s ease;
        }

        #volume-slider::-webkit-slider-thumb:hover {
            background: #ffd6e8;
        }

        #volume-slider::-moz-range-thumb {
            width: 28px;
            height: 28px;
            background: #fff0f6;
            border: 2px solid #ff4fa2;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 8px #ff4fa2aa;
            transition: background 0.3s ease;
        }

        #volume-slider::-moz-range-thumb:hover {
            background: #ffd6e8;
        }
    </style>
</head>

<body>
    <h1>âœ¨ Pet the Magical Blob âœ¨</h1>
    <div id="blob" role="button" tabindex="0" aria-label="Magical blob, click to pet">
        <div id="accessory">ðŸŽ€</div>
        <div class="face">uwu</div>
    </div>
    <p><span id="count">Pats: 0</span></p>
    <div id="message" role="status"></div>
    <button id="reset-btn">ðŸ”„ Reset</button>

    <!-- Sounds -->
    <audio id="squish1" src="./src/squish1.wav" preload="auto"></audio>
    <audio id="squish2" src="./src/squish2.wav" preload="auto"></audio>
    <audio id="bg-music" src="./bg-soft.mp3" autoplay loop muted preload="auto"></audio>

    <!-- Volume slider -->
    <div id="volume-container" title="Adjust Background Music Volume">
        <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.1"
            aria-label="Background music volume slider" />
    </div>


    <script>
        const blob = document.getElementById("blob");
        const countText = document.getElementById("count");
        const bgMusic = document.getElementById("bg-music");
        const accessory = document.getElementById("accessory");
        const message = document.getElementById("message");
        const resetBtn = document.getElementById("reset-btn");
        const squishSounds = [document.getElementById("squish1"), document.getElementById("squish2")];
        const volumeSlider = document.getElementById("volume-slider");

        let count = parseInt(localStorage.getItem("pats")) || 0;
        updateDisplay();

        const messages = [
            { milestone: 5, text: "You found the sweet spot! ðŸ¬" },
            { milestone: 10, text: "Blob is feeling the love! ðŸ’ž" },
            { milestone: 20, text: "You are a pro petter! ðŸ¾" },
            { milestone: 35, text: "Blob has evolved! ðŸ‘‘" },
            { milestone: 50, text: "Youâ€™ve unlocked blob wings! ðŸª½" },
            { milestone: 75, text: "Blob learned to dance! ðŸ’ƒ" },
            { milestone: 100, text: "Blob sings with joy! ðŸŽ¤" },
            { milestone: 125, text: "Blob can now fly! ðŸª¶" },
            { milestone: 150, text: "Blob's heart is bursting! ðŸ’—ðŸ’—" },
            { milestone: 175, text: "Blob discovered glitter magic! âœ¨" },
            { milestone: 200, text: "Youâ€™ve unlocked Blob Ultra! ðŸŒŸ" },
            { milestone: 250, text: "Blob is now your best friend! ðŸ«¶" },
            { milestone: 300, text: "THE ULTIMATE PATTING CHAMPION! ðŸ‘‘âœ¨ðŸŽ‰" }
        ];

        // Initialize bg music volume & muted
        bgMusic.volume = volumeSlider.value;
        bgMusic.muted = true;

        // Unmute and play on first user interaction (click or key)
        function enableAudio() {
            if (bgMusic.muted) {
                bgMusic.muted = false;
                bgMusic.volume = volumeSlider.value;
                bgMusic.play().catch(() => { /* ignore play errors */ });
            }
            window.removeEventListener('click', enableAudio);
            window.removeEventListener('keydown', enableAudio);
        }
        window.addEventListener('click', enableAudio);
        window.addEventListener('keydown', enableAudio);

        // Volume slider changes bg music volume
        volumeSlider.addEventListener('input', () => {
            bgMusic.volume = volumeSlider.value;
            // if volume 0, mute the music, else unmute
            if (volumeSlider.value == 0) {
                bgMusic.muted = true;
            } else {
                bgMusic.muted = false;
            }
        });

        blob.addEventListener("click", petBlob);
        blob.addEventListener("keydown", e => {
            if (["Enter", " ", "Spacebar"].includes(e.key)) {
                e.preventDefault();
                petBlob(e);
            }
        });

        resetBtn.addEventListener("click", () => {
            count = 0;
            localStorage.setItem("pats", count);
            updateDisplay();
            message.textContent = "Reset complete! Start petting again ðŸ’–";
            setTimeout(() => message.textContent = "", 4000);
        });

        function petBlob(e) {
            count++;
            localStorage.setItem("pats", count);
            updateDisplay();
            checkMilestone();

            blob.classList.add("happy");
            const sound = squishSounds[Math.floor(Math.random() * squishSounds.length)];
            sound.currentTime = 0;
            sound.play();

            const rect = blob.getBoundingClientRect();
            const x = e.clientX || rect.left + rect.width / 2;
            const y = e.clientY || rect.top + rect.height / 2;

            const heart = document.createElement("div");
            heart.className = "heart";
            heart.textContent = "ðŸ’–";
            heart.style.left = `${x}px`;
            heart.style.top = `${y}px`;

            const sparkle = document.createElement("div");
            sparkle.className = "sparkle";
            sparkle.textContent = "âœ¨";
            sparkle.style.left = `${x + 20}px`;
            sparkle.style.top = `${y}px`;

            document.body.appendChild(heart);
            document.body.appendChild(sparkle);

            setTimeout(() => {
                blob.classList.remove("happy");
                heart.remove();
                sparkle.remove();
            }, 1000);
        }

        function updateDisplay() {
            countText.textContent = `Pats: ${count}`;
            updateBlobEvolution();
        }

        function updateBlobEvolution() {
            if (count >= 300) accessory.textContent = "ðŸ‘‘âœ¨ðŸŽ‰";
            else if (count >= 250) accessory.textContent = "ðŸ«¶";
            else if (count >= 200) accessory.textContent = "ðŸŒŸ";
            else if (count >= 175) accessory.textContent = "âœ¨";
            else if (count >= 150) accessory.textContent = "ðŸ’—ðŸ’—";
            else if (count >= 125) accessory.textContent = "ðŸª¶";
            else if (count >= 100) accessory.textContent = "ðŸŽ¤";
            else if (count >= 75) accessory.textContent = "ðŸ’ƒ";
            else if (count >= 50) accessory.textContent = "ðŸª½";
            else if (count >= 35) accessory.textContent = "ðŸ‘‘";
            else if (count >= 20) accessory.textContent = "ðŸ¾";
            else if (count >= 10) accessory.textContent = "ðŸ’ž";
            else if (count >= 5) accessory.textContent = "ðŸ¬";
            else accessory.textContent = "ðŸŽ€";
        }

        function checkMilestone() {
            const msg = messages.find(m => m.milestone === count);
            if (msg) {
                message.textContent = msg.text;
                setTimeout(() => message.textContent = "", 4000);
            }
        }
    </script>
</body>

</html>
